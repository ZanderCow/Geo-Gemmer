{% from "components/footer.html" import footer %}
{% from "components/signed-in-navbar.html" import signed_in_navbar %}
{% from "components/gem-searcher.html" import gem_searcher %}
<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Gem Search</title>
    <link rel="icon" href="/static/img/geo-icon.png">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=ABeeZee&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Alexandria&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Didact+Gothic&amp;display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=DM+Sans&amp;display=swap">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="/static/css/styles.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    
</head>

<body id="page-top">
    {{ signed_in_navbar() }}

    <div class="container-fluid">
        <div class="text-center" style="padding-top: 15px;">
            <p class="fw-bold text-success mb-2" data-aos="fade">Gem Search</p>
            <h2 class="fw-bold" data-aos="fade">Searching For {{'"'+user_query+'"' if user_query != "" else "Nearest"}}</h2>
            <div style="padding-top: 15px;padding-bottom: 15px;">
                <div class="d-xl-flex d-xxl-flex justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center text-center">
                    <div class="d-xl-flex d-xxl-flex justify-content-xl-center align-items-xl-center justify-content-xxl-center align-items-xxl-center text-center">
                    <div id="type-dropdown" class="dropdown" style="padding-left: 15px;padding-right: 15px;">
                        <button class="btn dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="padding: 0px;color: rgb(0,0,0);">
                            <span id="selected-type" style="color: rgb(0, 0, 0);">Type</span>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#" data-value="Hiking Trail">Hiking Trail</a>
                            <a class="dropdown-item" href="#" data-value="Restaurant">Restaurant</a>
                            <a class="dropdown-item" href="#" data-value="Park">Park</a>
                            <a class="dropdown-item" href="#" data-value="Gym">Gym</a>
                            <a class="dropdown-item" href="#" data-value="Museum">Museum</a>
                            <a class="dropdown-item" href="#" data-value="Beach">Beach</a>
                            <a class="dropdown-item" href="#" data-value="Shopping Mall">Shopping Mall</a>
                            <a class="dropdown-item" href="#" data-value="Movie Theater">Movie Theater</a>
                            <a class="dropdown-item" href="#" data-value="Zoo">Zoo</a>
                            <a class="dropdown-item" href="#" data-value="Aquarium">Aquarium</a>
                        </div>
                    </div>
                    
                    
                    <!-- Unique ID for each dropdown, using 'AccessibilityMenu1' as an example -->
                    <div id="accessibility-dropdown" class="dropdown" style="padding: 15px;">
                        <button class="btn dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="padding: 0px; color: black;">
                            <span id="selected-accesibility" style="color: black;">Accessibility</span>
                        </button>
                        <div class="dropdown-menu">
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="wheelchair_accessible"> Wheelchair Accessible</label>
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="service_animal_friendly"> Service Animal Friendly</label>
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="multilingual_support"> Multilingual Support</label>
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="braille_signage"> Braille Signage</label>
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="hearing_assistance"> Hearing Assistance</label>
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="large_print_materials"> Large Print Materials</label>
                            <label class="dropdown-item"><input type="checkbox" name="accessibility" value="accessible_restrooms"> Accessible Restrooms</label>
                        </div>
                    </div>
                
           
                    
                
                    
                    
            
                    <div id="distance-dropdown" class="dropdown" style="padding-left: 15px; padding-right: 15px;">
                        <button class="btn dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="padding: 0px; color: rgb(0,0,0);">
                            <span id="selected-distance" style="color: rgb(0, 0, 0);">Distance</span>
                        </button>
                        <div class="dropdown-menu">
                            <label class="dropdown-item">
                                <input id="distanceSlider" class="form-range" type="range" min="0" max="500" value="50" oninput="updateDistanceValue(this.value)"> <!-- Added min, max, and value attributes for demonstration -->
                            </label>
                            <label class="dropdown-item">
                                <span class="text-center justify-content-md-center" id="distanceValue">50 km</span> 
                            </label>
                        </div>
                    </div>
                 
                    
                    <div id="review-dropdown" class="dropdown" style="padding-left: 15px;padding-right: 15px;">
                        <button class="btn dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" type="button" style="padding: 0px;color: rgb(0,0,0);">
                            <span id="selected-review-option" style="color: rgb(0, 0, 0);">Minimum Rating</span>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#" data-value="1">1 Star</a>
                            <a class="dropdown-item" href="#" data-value="2">2 Stars</a>
                            <a class="dropdown-item" href="#" data-value="3">3 Stars</a>
                            <a class="dropdown-item" href="#" data-value="4">4 Stars</a>
                            <a class="dropdown-item" href="#" data-value="5">5 Stars</a>
                        </div>
                    </div>
                    <button class="btn btn-success btn-sm" data-bss-hover-animate="pulse" type="submit"><span style="color: rgb(255, 255, 255);">Apply Filters</span></button>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid scstyle-1 sc-overflow" data-aos="fade" id="gem-search">
        <div class="row gy-4 row-cols-1 row-cols-md-2 row-cols-xl-3 d-md-flex d-lg-flex justify-content-md-center">
            {{ gem_searcher(gem_data) }}
            <div class="col flex-grow-1 flex-fill" style="height: 600px;">
                <div class="card shadow-sm" style="height: 600px;">
                    <div id="google-maps-container" class="card-body skeleton-loader" style="height: 500px;display: flex; align-items: center; justify-content: center;">
                        <img src="https://cdn.freebiesupply.com/logos/large/2x/google-icon-logo-png-transparent.png" id="loader" style="scale:0.8;max-height:40%;position:absolute; filter: saturate(0.6) brightness(0.6);z-index:10">
                        <div id="map" class="card-body d-xxl-flex justify-content-xxl-center align-items-xxl-center d-none" style="height: 500px;">
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="mapLoaded();" class="btn">Simulate that its loaded</button>
        </div>
    </div>

   
    
    {{ footer() }}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                
                fetch(`/gem/map?lat=${latitude}&lng=${longitude}&callback=initMap`)
                .then(response => response.text())
                .then(data => {
                    const scriptElement = document.createElement('script');
                    scriptElement.textContent = data;
                    document.body.appendChild(scriptElement);
                    document.getElementById('bottom-spinner').classList.add('d-none');
                    document.getElementById('map').classList.remove('d-none');
                })
                .catch(error => window.location.href = '/user');
   
            }), function(error) {
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        alert("User denied the request for Geolocation.");
                        break;
                    case error.POSITION_UNAVAILABLE:
                        alert("Location information is unavailable.");
                        break;
                    case error.TIMEOUT:
                        alert("The request to get user location timed out.");
                        break;
                    default:
                        alert("An unknown error occurred.");
                        break;
                }
            };
        } 
        
    </script>


    
    <script src="/static/js/gem-search-filter-selection.js"></script>
    <script src="/static/js/script.min.js"></script>
    <script>
        let i = 0;
        let eee = 0; let ecceler = 1;
        var end=false;
        let img = document.getElementById("loader");
        let currAngle = 0;
        function rotate() {
            console.log(end)
            if (end) {
                currAngle += eee;
                eee+=1*ecceler;
                ecceler+=0.001;
                img.style.transform = `rotate(${currAngle}deg)`;
                img.style.scale=0.8+currAngle*0.0002;
                img.style.opacity=1-currAngle*0.0005;
                if (currAngle < 2000) {
                    requestAnimationFrame(rotate);
                } else {
                    img.parentNode.removeChild(img);
                }
            } else {
                // Get the image element
                currAngle = 25 * Math.sin(i / 180);
                img.style.transform = `rotate(${currAngle}deg)`;
                i = (i+15)%1120;
                // Call the rotate function again on the next frame
                requestAnimationFrame(rotate);
            }
        }
        // Start the rotation
        rotate();
        //delett skeleton loader
        function mapLoaded() {
            var map = document.getElementById('google-maps-container')
            if (map != null)
                console.log("has map");
            else
                console.("no has map");
            
            // Add a listener for the 'tilesloaded' event to remove the skeleton loader
            google.maps.event.addListenerOnce(map, 'tilesloaded', function(){
                map.classList.remove('skeleton-loader');
                end = true;
            });
        }
        
        // Load the map
        //mapLoaded();
    </script>
</body>

</html>

